from flask import Flask, render_template
import subprocess, re

#! pip intsall flask

app = Flask(__name__, template_folder='html/')

@app.route('/')
def home():
    icon, ssid = wifi_strength()
    return render_template('home.html', icon=icon, ssid=ssid )

@app.route('/about')
def about():
    return 'This is the about page'

@app.route('/contact')
def contact():
    return 'This is the contact page'

def wifi_strength():
    cmd = "iwconfig wlan0 | grep 'Signal level'"
    output = subprocess.check_output(cmd, shell=True).decode()
    signal_strength = re.search('Signal level=(-\d+)', output).group(1)
    signal_strength = int(signal_strength)
    cmd = "iwgetid -r"
    ssid = subprocess.check_output(cmd, shell=True).decode().strip()
    if signal_strength > -50:
        icon = 'wifi-4-bars'
    elif signal_strength > -60:
        icon = 'wifi-3-bars'
    elif signal_strength > -70:
        icon = 'wifi-2-bars'
    elif signal_strength > -80:
        icon = 'wifi-1-bar'
    else:
        icon = 'wifi-0-bars'
    return icon, ssid

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0')